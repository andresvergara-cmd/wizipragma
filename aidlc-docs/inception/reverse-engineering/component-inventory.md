# Component Inventory

## Application Packages

### src_aws/app_connect
- **Type**: Lambda Function Handler
- **Purpose**: Establecer conexión WebSocket cuando usuario inicia sesión
- **Language**: Python 3.10
- **Files**: 1 (app_connect.py)
- **Dependencies**: json (stdlib)
- **Complexity**: Minimal

### src_aws/app_disconnect
- **Type**: Lambda Function Handler
- **Purpose**: Cerrar conexión WebSocket cuando usuario finaliza sesión
- **Language**: Python 3.10
- **Files**: 1 (app_disconnect.py)
- **Dependencies**: json (stdlib)
- **Complexity**: Minimal

### src_aws/app_inference
- **Type**: Lambda Function Handler + Business Logic
- **Purpose**: Procesar consultas financieras y generar respuestas AI personalizadas
- **Language**: Python 3.10
- **Files**: 4 (app.py, config.py, bedrock_config.py, data_config.py)
- **Dependencies**: boto3, loguru, langchain-aws (layer)
- **Complexity**: High - Core business logic

## Infrastructure Packages

### SAM Template (poc_template.yaml)
- **Type**: Infrastructure as Code
- **Technology**: AWS SAM (CloudFormation)
- **Purpose**: Definir y desplegar toda la infraestructura AWS
- **Resources Defined**:
  - 4 DynamoDB Tables
  - 3 Lambda Functions
  - 1 WebSocket API Gateway
  - Routes, Integrations, Permissions
- **Parameters**: 4 (Stage, ProjectName, ProjectPrefix, ModelId, LayerSelected)
- **Outputs**: 2 (ConnectionsURL, WebSocketURL)

### Deployment Scripts (commands/)
- **Type**: Automation Scripts
- **Purpose**: Automatizar deployment de aplicación
- **Files**: 1 (deploy.sh)
- **Technology**: Bash

## Shared Packages

### Lambda Layer: pragma-bankia-layer-dev
- **Type**: Shared Dependencies Layer
- **Purpose**: Proporcionar dependencias pesadas compartidas entre Lambdas
- **Contents**: 
  - langchain-aws (^0.2.0)
  - loguru (^0.7.2)
- **Usage**: Lambda Inference Function
- **Version**: 1

### Data Files (data/)
- **Type**: Sample/Seed Data
- **Purpose**: Datos de ejemplo para testing y desarrollo
- **Files**: 3
  - users_mx.json - Perfiles de usuarios mexicanos
  - transactions_mx.json - Transacciones de ejemplo
  - stores_mx.json - Retailers y beneficios
- **Format**: JSON

## Test/Development Packages

### Notebooks (notebooks/)
- **Type**: Jupyter Notebooks
- **Purpose**: Testing, desarrollo, experimentación
- **Files**: 1 (test.ipynb)
- **Dependencies**: ipykernel, pandas, streamlit (dev dependencies)

## Configuration Files

### pyproject.toml
- **Type**: Build Configuration
- **Purpose**: Definir dependencias y configuración del proyecto
- **Build System**: Poetry
- **Python Version**: >=3.9, <3.9.7 || >3.9.7, <3.11
- **Dependencies**: 10 packages

### poetry.lock
- **Type**: Dependency Lock File
- **Purpose**: Versiones exactas de todas las dependencias
- **Generated By**: Poetry

## Frontend/Demo

### index.html
- **Type**: HTML Page
- **Purpose**: Posible frontend demo o landing page
- **Status**: No analizado en detalle (fuera de scope backend)

## Empty/Future Directories

### gen2/
- **Type**: Empty Directory
- **Purpose**: Reservado para uso futuro (posiblemente generación 2 de la aplicación)
- **Status**: Sin contenido

## Total Count

### By Type
- **Application Packages**: 3 (app_connect, app_disconnect, app_inference)
- **Infrastructure Packages**: 2 (SAM template, deployment scripts)
- **Shared Packages**: 2 (Lambda Layer, data files)
- **Test/Development**: 1 (notebooks)
- **Configuration**: 2 (pyproject.toml, poetry.lock)
- **Frontend**: 1 (index.html)
- **Empty**: 1 (gen2/)

### By Language/Technology
- **Python**: 6 files (3 handlers + 3 modules)
- **YAML**: 1 file (SAM template)
- **JSON**: 3 files (data)
- **Bash**: 1 file (deploy script)
- **HTML**: 1 file (frontend)
- **Jupyter**: 1 file (notebook)
- **TOML**: 1 file (pyproject)

### By Complexity
- **High Complexity**: 1 (app_inference - 4 modules, core logic)
- **Medium Complexity**: 1 (SAM template - infrastructure definition)
- **Low Complexity**: 2 (app_connect, app_disconnect - simple handlers)
- **Minimal**: 5 (config files, data files, scripts)

## Component Dependencies

### Internal Dependencies
```
app_inference/app.py
  ├── depends on: config.py
  └── depends on: data_config.py

config.py
  └── depends on: bedrock_config.py

bedrock_config.py
  └── (no internal dependencies)

data_config.py
  └── (no internal dependencies)

app_connect.py
  └── (no internal dependencies)

app_disconnect.py
  └── (no internal dependencies)
```

### External Service Dependencies
```
All Lambda Functions
  └── AWS Lambda Runtime

app_inference
  ├── AWS Bedrock (bedrock-runtime)
  ├── AWS DynamoDB (4 tables)
  └── AWS API Gateway Management API

SAM Template
  └── AWS CloudFormation

Lambda Layer
  └── AWS Lambda Layers Service
```

## Deployment Units

### Unit 1: Infrastructure
- **Components**: SAM template, deployment script
- **Deployment Method**: AWS SAM CLI / CloudFormation
- **Dependencies**: AWS account, SAM CLI installed
- **Order**: Must deploy first

### Unit 2: Lambda Layer
- **Components**: pragma-bankia-layer-dev
- **Deployment Method**: Manual or separate SAM template
- **Dependencies**: langchain-aws, loguru packages
- **Order**: Must exist before Lambda functions

### Unit 3: Lambda Functions
- **Components**: app_connect, app_disconnect, app_inference
- **Deployment Method**: SAM deploy (CodeUri in template)
- **Dependencies**: Infrastructure, Lambda Layer
- **Order**: Deploy after infrastructure and layer

### Unit 4: Data Seeding (Optional)
- **Components**: data/*.json files
- **Deployment Method**: Manual DynamoDB import or script
- **Dependencies**: DynamoDB tables created
- **Order**: After infrastructure deployment

## Component Maturity Assessment

### Production-Ready
- Lambda handlers (connect, disconnect, inference)
- SAM infrastructure template
- Core business logic (config, bedrock_config, data_config)

### Development/Testing
- Notebooks (test.ipynb)
- Data files (sample data)
- index.html (demo page)

### Needs Improvement
- Error handling (some areas could be more robust)
- Security (WebSocket sin autenticación)
- Configuration (hardcoded table names en config.py)
- Testing (no unit tests detectados)
- Documentation (código comentado pero sin docs formales)

### Future/Placeholder
- gen2/ directory (sin contenido)
